---
title: "Introduction to penguinglyphs"
output: 
  rmarkdown::html_vignette:
  fig_caption: yes
bibliography: ["references.bib"]
csl: apa.csl
vignette: >
  %\VignetteIndexEntry{Introduction to penguinglyphs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.width = 7,
  fig.height = 5
)
```

## Overview

In data visualization, a "glyph" is a small graphical object, such as a shape, icon, or marker, that represents a single observation. Glyphs are used to visualize multidimensional data by encoding different variables into various visual attributes like shape, size, color, and orientation. The use of "glyphs" to represent multivariate data has a long history [@Ward2008]. One of the early uses, by Edgar Anderson [-@Anderson:1957], used circular glyphs with rays to study botanical species, including the famous Iris Flowers [@Kleinman:2002].
More recently, @Chernoff:1973 introduced the use of schematic faces that could represent up to 15 data variables
simultaneously.

The `penguinglyphs` package is an experiment in the use of glyphs to represent the observations in
the datasets on Penguins in Antartica, now in the R datasets `datasets::penguins`.
The first step was to see how Penguin features, like body mass, flipper length and the length and depth of
their bills could be represented **parametrically**, and thus encoded in ways to permit drawing a penguin observation using R graphics like `polygon()`, `segments()` and so forth.


## Installation

```{r eval=FALSE}
# Install from GitHub
devtools::install_github("friendly/penguinglyphs")
```

```{r setup}
library(penguinglyphs)
```

## Visual Encoding

The package uses the following mappings:

- **Bill length** → horizontal extent of the bill
- **Bill depth** → vertical thickness of the bill
- **Flipper length** → length of the flippers
- **Body mass** → overall body size
- **Species** → body color (Adelie=orange, Chinstrap=purple, Gentoo=green)
- **Sex** → eye shape (angular for males, round for females)

## Basic Usage

First, let's load the Palmer Penguins dataset:

```{r}
# Load penguin data
data(penguins, package = "datasets")

# Look at the structure
head(penguins)
```

### Creating a Grid of Glyphs

The main function is `penguin_glyphs()`, which creates a grid display, 5 columns wide by default.
Here, I show the first five penguins of each species.

```{r}
#| label: fig-peng15
#| fig-width: 8
#| fig-height: 6
#| fig-cap: Glyphs for the first five penguins in each species
# Visualize first 5 penguins in each species
which <- outer(1:5, c(0, 152, 277), FUN ="+") |> c()
penguin_glyphs(penguins[which,])
```

What happened with case 4? It contains missing missing `NA` values, so no glyph is drawn.
Henceforth, I'll work with the subset that contains no missing values

```{r}
penguins <- tidyr::drop_na(penguins)
```


### Random Sample

```{r fig.width=8, fig.height=6}
set.seed(42)
sampled_rows <- sample(1:nrow(penguins), size = 20)
penguin_glyphs(penguins[sampled_rows, ], main = "Random Sample of Penguins")
```

## Drawing Individual Penguins

For more control, you can draw individual penguins with `draw_penguin()`:

```{r fig.width=6, fig.height=4}
# Create plot area
plot(1, xlim=c(0,4), ylim=c(0,2), type="n", asp=1,
     xlab="", ylab="", main="Species Comparison")

# Draw one of each species
draw_penguin(1, 1, species="Adelie", sex="male", id="Adelie")
draw_penguin(2, 1, species="Chinstrap", sex="female", id="Chinstrap")
draw_penguin(3, 1, species="Gentoo", sex="male", id="Gentoo")
```

## Finding Patterns

### Examining Outliers

Unusual multivariate cases are easily identified using Mahalanobis $D^2$. Here, I find the three most noteworthy observations
in the total sample (ignoring `species`).

```{r}
library(heplots)
DSQ <- heplots::Mahalanobis(penguins[, 3:6])
outliers <- order(DSQ, decreasing = TRUE)[1:3] |>
  print()
```

You can see them in a $\chi^2$ QQ plot of the quantiles of the $D^2$ values against what they would be in a multivariate normal
distribution for four variables.

```{r}
clr <- c(Adelie = "#F37A00", Chinstrap = "#6A3D9A", Gentoo = "#33a02c")
pch <- c(19, 17, 15)   # ggplot symbol defaults for a factor

out <- heplots::cqplot(peng[, 3:6], 
   id.n = 3,
   col = clr[penguins$species],
   pch = pch[penguins$species],
   ref.col = "grey",
   what = "Penguin numeric variables",
   cex.lab = 1.25)
out
```


```{r fig.width=6, fig.height=3}
# Look at some notable penguins
penguin_glyphs(penguins[outliers,], ncol=3, main = "Notable Penguins")
```

### Visual Lineup

A "line-up" test [@Buja-etal2009]
has been proposed as a **human significance test*: Can an observer spot a difference that rejects a null hypothesis?
This is more a test of a data visualization per se than of the human observer. 



Here are glyphs for 20 penguins, representing the main variables with visual features.

Create a lineup where you try to spot the outliers among normal penguins:

```{r fig.width=8, fig.height=6}
# Create a lineup for visual inference
set.seed(123)
cast <- c(sample(1:nrow(penguins), size = 17), outliers)
lineup <- sample(cast, size = length(cast))
penguin_glyphs(penguins[lineup,], main = "Can you spot the outliers?")
```

## Customization

### Legend Placement

In the current version, legend placement doesn't work all that well, but you can try to modify it.

```{r fig.width=8, fig.height=6}
penguin_glyphs(penguins[sampled_rows, ], 
               main = "Custom Legend",
               legend = list(loc = "bottom", horiz = FALSE))
```

### Different Grid Layouts

```{r fig.width=10, fig.height=4}
# Fewer columns for a wider display
penguin_glyphs(head(penguins, 15), 
               ncol = 8, 
               main = "Wide Layout")
```

## Interpreting the Glyphs

When looking at penguin glyphs, you can quickly identify:

1. **Size differences**: Larger body mass creates bigger penguins overall
2. **Bill proportions**: Long, thin bills vs. short, deep bills
3. **Flipper length**: Longer flippers extend further from the body
4. **Species patterns**: Immediate identification via color
5. **Sex differences**: Subtle but consistent eye shape differences

This makes it easy to spot:
- Species-specific morphology
- Sexual dimorphism within species
- Individual outliers
- General population patterns

## Conclusion

The `penguinglyphs` package provides an intuitive way to explore multivariate data through visual encodings that leverage our natural ability to perceive shapes and patterns. It's particularly useful for:

- Exploratory data analysis
- Identifying outliers
- Communicating patterns to diverse audiences
- Teaching data visualization concepts
